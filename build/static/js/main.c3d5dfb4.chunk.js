(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,n){e.exports=n(20)},16:function(e,t,n){},18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(9),s=n.n(i),u=(n(16),n(2)),o=n(1),l=n(3),c=n(4),h=n(6),d=n(5),m=n(7),p=(n(18),{NORMAL:1,FEARSOME:2,TERRIFYING:3}),f={EMPTY:"empty",CLOSE:"close",RANGE:"range",HOLD:"hold",DISRUPTED:"disrupted",ROUT:"rout",DEAD:"dead"},v={rollDie:function(){return Math.floor(6*Math.random())+1}},g={getCourage:function(e){var t=e.courage;return null!=e.temp_courage_mod&&(t+=e.temp_courage_mod),this.inTheYellow(e)?t-1:this.inTheRed(e)?t-2:void 0},isDead:function(e){return 0===e.life_boxes.reduce(function(e,t){return e+t},0)},isDeadOrRouting:function(e){return g.isDead(e)||e.order===f.ROUT},applyDamage:function(e,t){var n=e.life_boxes,r=!1,a=e.order;if(t>0)for(var i=0;i<3;i++)if(e.life_boxes[i]>0){var s=Math.min(e.life_boxes[i],t);s>0&&2===i&&(e.needs_rout_check=!0),n[i]=e.life_boxes[i]-s,t-=s,0===n[i]&&(2===i&&(a=f.DEAD),r=!0)}return Object(o.a)({},e,{life_boxes:n,needs_rout_check:r,order:a})},inTheRed:function(e){return 0===e.life_boxes[0]&&0===e.life_boxes[1]},inTheYellow:function(e){return 0===e.life_boxes[0]&&e.life_boxes[1]>0},getDice:function(e){return this.inTheYellow(e)?Math.max(1,e.dice-1):this.inTheRed(e)?Math.max(1,e.dice-2):e.dice},getChargingDice:function(e,t){return t?this.inTheYellow(e)?1:this.inTheRed(e)?0:2:0},getImpactHits:function(e,t){return t?e.impact_hits:0}},_=g,w={resolveFearCheck:function(e,t){return t.fear_level===p.TERRIFYING&&e.fear_level===p.NORMAL?Object(o.a)({},e,{temp_courage_mod:-1}):e},resolveRoutCheck:function(e){return e.needs_rout_check?this.rollCourage()>_.getCourage(e)?Object(o.a)({},e,{order:f.ROUT}):Object(o.a)({},e,{needs_rout_check:!1}):e},rollCourage:function(){return v.rollDie()+v.rollDie()+v.rollDie()}},b={canAttack:function(e,t){return e.range<=t},calculateDamage:function(e,t,n){var r=this.makeAttackStat(e,n),a=this.makeDefenseStat(t);return this.rollAttack(r,a)},makeAttackStat:function(e,t){return{dice:_.getDice(e)+_.getChargingDice(e,t),impact_hits:_.getImpactHits(e,t),attack:e.attack,power:e.power}},makeDefenseStat:function(e){return{defense:e.defense,toughness:e.toughness}},rollAttack:function(e,t){for(var n=0,r=0;r<e.dice;r++){var a=v.rollDie();1===a?n++:a<=e.attack-t.defense&&n++}n+=e.impact_hits;for(var i=0,s=0;s<n;s++){var u=v.rollDie();1===u?i++:u<=e.power-t.toughness&&i++}return i}},k={winsPerUnit:function(e,t){return e.reduce(function(e,n){return e+(n.winner===t?1:0)},0)}},D={simulateMany:function(e,t,n){for(var r=[],a=0;a<n;a++){var i=this.simulateGame(e,t);r.push(i)}var s=k.winsPerUnit(r,e.name),u=k.winsPerUnit(r,t.name),o=k.winsPerUnit(r,"draw");return{unit1_wins:s,unit1_wins_percent:100*s/n,unit2_wins:u,unit2_wins_percent:100*u/n,draws:o,draws_percent:100*o/n}},simulateGame:function(e,t){for(var n=20,r=0,a=this.parseUnit(e),i=this.parseUnit(t);r<200;){r+=1;var s=this.simulateTurn(a,i,n);if(_.isDeadOrRouting(s.activeUnit)&&_.isDeadOrRouting(s.passiveUnit))return{turns:r,winner:"draw",loser_order:s.activeUnit.order};if(_.isDeadOrRouting(s.activeUnit))return{turns:r,winner:i.name,loser_order:s.activeUnit.order};if(_.isDeadOrRouting(s.passiveUnit))return{turns:r,winner:a.name,loser_order:s.passiveUnit.order};a=s.passiveUnit,i=s.activeUnit,n=s.distance}return{turns:r,winner:"not sure"}},simulateTurn:function(e,t,n){var r=!1;n>0&&(n=Math.min(0,n-e.speed))<.1&&(r=!0);var a=this.resolveCombatPhase(e,t,r,n);return{activeUnit:a.activeUnit,passiveUnit:a.passiveUnit,distance:n}},resolveCombatPhase:function(e,t,n,r){if(n&&(e=w.resolveFearCheck(e,t),t=w.resolveFearCheck(t,e)),b.canAttack(e,r)){var a=b.calculateDamage(e,t,n);t=_.applyDamage(t,a)}if(b.canAttack(t,r)){var i=b.calculateDamage(t,e,n);e=_.applyDamage(e,i)}return{activeUnit:e=w.resolveRoutCheck(e),passiveUnit:t=w.resolveRoutCheck(t)}},parseUnit:function(e){return Object(o.a)({},e,{life_boxes:[Number(e.green),Number(e.yellow),Number(e.red)]})}},O=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleInputChange=function(e){var t=e.currentTarget,r=t.value,a=t.name,i=r;"name"!==a&&(i=Number(r)?Number(r):0);var s=Object(o.a)({},n.props.values,Object(u.a)({},a,i));n.props.onChange(n.props.unitKey,s)},n.renderInputs=function(){return Object.keys(n.props.values).map(n.renderInput)},n.renderInput=function(e){return a.a.createElement("div",{key:e},a.a.createElement("label",null,e," ",a.a.createElement("input",{type:"text",value:n.props.values[e],name:e,onChange:n.handleInputChange})))},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("div",null,this.props.unitKey),this.renderInputs())}}]),t}(a.a.Component),U=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(h.a)(this,Object(d.a)(t).call(this))).handleSimulateClick=function(){var t=D.simulateMany(e.state.unit1,e.state.unit2,e.state.num_games);e.setState({results:t})},e.handleUnitPropertyValueChange=function(t,n){e.setState(Object(u.a)({},t,n))},e.renderUnit=function(t,n){return a.a.createElement(O,{values:t,unitKey:n,onChange:e.handleUnitPropertyValueChange})},e.state={results:{turns:0,winner:"press button to start simulation"},num_games:2e3,unit1:{name:"Phalanx",green:6,yellow:2,red:2,dice:5,attack:7,power:5,defense:2,toughness:2,courage:12,range:0,speed:3.5,fear_level:1,impact_hits:1},unit2:{name:"Orc Axemen",green:5,yellow:3,red:2,dice:5,attack:6,power:6,defense:1,toughness:3,courage:13,range:0,speed:3.5,fear_level:1,impact_hits:0}},e}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return console.log(this.state.results),a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("h1",null,"Battle simulator"),a.a.createElement("div",null,"Number of games: ",this.state.num_games),a.a.createElement("div",null,this.renderUnit(this.state.unit1,"unit1")),a.a.createElement("div",null,this.renderUnit(this.state.unit2,"unit2")),a.a.createElement("button",{onClick:this.handleSimulateClick},"Simulate"),a.a.createElement("h2",null,"Simulation results"),a.a.createElement("div",null,this.state.unit1.name," wins: ",this.state.results.unit1_wins,"(",this.state.results.unit1_wins_percent,"%)"),a.a.createElement("div",null," ",this.state.unit2.name," wins: ",this.state.results.unit2_wins,"(",this.state.results.unit2_wins_percent,"%)"),a.a.createElement("div",null,"Draws: ",this.state.results.draws,"(",this.state.results.draws_percent,"%) ")))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[10,2,1]]]);
//# sourceMappingURL=main.c3d5dfb4.chunk.js.map