(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,n){e.exports=n(20)},16:function(e,t,n){},18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(9),o=n.n(i),s=(n(16),n(2)),u=n(1),l=n(3),c=n(4),d=n(6),h=n(5),m=n(7),f=(n(18),{EMPTY:"empty",CLOSE:"close",RANGE:"range",HOLD:"hold",DISRUPTED:"disrupted",ROUT:"rout",DEAD:"dead"}),p={rollDie:function(){return Math.floor(6*Math.random())+1}},v={getCourage:function(e){var t=e.courage;return null!=e.temp_courage_mod&&(t+=e.temp_courage_mod),this.inTheYellow(e)?t-1:this.inTheRed(e)?t-2:void 0},isDead:function(e){return 0===e.life_boxes.reduce(function(e,t){return e+t},0)},isDeadOrRouting:function(e){return v.isDead(e)||e.order===f.ROUT},applyDamage:function(e,t){var n=e.life_boxes,r=!1,a=e.order;if(t>0)for(var i=0;i<3;i++)if(e.life_boxes[i]>0){var o=Math.min(e.life_boxes[i],t);o>0&&2===i&&(e.needs_rout_check=!0),n[i]=e.life_boxes[i]-o,t-=o,0===n[i]&&(2===i&&(a=f.DEAD),r=!0)}return Object(u.a)({},e,{life_boxes:n,needs_rout_check:r,order:a})},inTheRed:function(e){return 0===e.life_boxes[0]&&0===e.life_boxes[1]},inTheYellow:function(e){return 0===e.life_boxes[0]&&e.life_boxes[1]>0},getDice:function(e){return this.inTheYellow(e)?Math.max(1,e.dice-1):this.inTheRed(e)?Math.max(1,e.dice-2):e.dice},getChargingDice:function(e,t){return t?this.inTheYellow(e)?1:this.inTheRed(e)?0:2:0},getImpactHits:function(e,t){return t?e.impact_hits:0}},g=v,b={resolveFearCheck:function(e,t){return this.isScared(e,t)&&this.rollCourage()>g.getCourage(e)?Object(u.a)({},e,{temp_courage_mod:-1}):e},isScared:function(e,t){return e.fear_level<t.fear_level},resolveRoutCheck:function(e){return e.needs_rout_check?this.rollCourage()>g.getCourage(e)?Object(u.a)({},e,{order:f.ROUT}):Object(u.a)({},e,{needs_rout_check:!1}):e},rollCourage:function(){return p.rollDie()+p.rollDie()+p.rollDie()}},_={canAttack:function(e,t){return e.range<=t},calculateDamage:function(e,t,n){var r=this.makeAttackStat(e,n),a=this.makeDefenseStat(t);return this.rollAttack(r,a)},makeAttackStat:function(e,t){return{dice:g.getDice(e)+g.getChargingDice(e,t),impact_hits:g.getImpactHits(e,t),attack:e.attack,power:e.power}},makeDefenseStat:function(e){return{defense:e.defense,toughness:e.toughness}},rollAttack:function(e,t){for(var n=0,r=0;r<e.dice;r++){var a=p.rollDie();1===a?n++:a<=e.attack-t.defense&&n++}n+=e.impact_hits;for(var i=0,o=0;o<n;o++){var s=p.rollDie();1===s?i++:s<=e.power-t.toughness&&i++}return i}},k={simulateGame:function(e,t){for(var n=20,r=0,a=this.parseUnit(e),i=this.parseUnit(t);r<200;){console.log("turn: ",r+1),r+=1;var o=this.simulateTurn(a,i,n);if(console.log("active unit:",o.activeUnit.name,o.activeUnit.life_boxes,o.activeUnit.order),console.log("passive unit:",o.passiveUnit.name,o.passiveUnit.life_boxes,o.passiveUnit.order),g.isDeadOrRouting(o.activeUnit)&&g.isDeadOrRouting(o.passiveUnit))return{turns:r,winner:"draw",loser_order:o.activeUnit.order};if(g.isDeadOrRouting(o.activeUnit))return{turns:r,winner:i.name,loser_order:o.activeUnit.order};if(g.isDeadOrRouting(o.passiveUnit))return{turns:r,winner:a.name,loser_order:o.passiveUnit.order};a=o.passiveUnit,i=o.activeUnit,n=o.distance}return{turns:r,winner:"not sure"}},simulateTurn:function(e,t,n){var r=!1;n>0&&(n=Math.min(0,n-e.speed))<.1&&(r=!0);var a=this.resolveCombatPhase(e,t,r,n);return{activeUnit:a.activeUnit,passiveUnit:a.passiveUnit,distance:n}},resolveCombatPhase:function(e,t,n,r){if(n&&(e=b.resolveFearCheck(e,t),t=b.resolveFearCheck(t,e)),_.canAttack(e,r)){var a=_.calculateDamage(e,t,n);t=g.applyDamage(t,a)}if(_.canAttack(t,r)){var i=_.calculateDamage(t,e,n);e=g.applyDamage(e,i)}return{activeUnit:e=b.resolveRoutCheck(e),passiveUnit:t=b.resolveRoutCheck(t)}},parseUnit:function(e){return Object(u.a)({},e,{life_boxes:[Number(e.green),Number(e.yellow),Number(e.red)]})}},U=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(i)))).handleInputChange=function(e){var t=e.currentTarget,r=t.value,a=t.name,i=Object(u.a)({},n.props.values,Object(s.a)({},a,r));n.props.onChange(n.props.unitKey,i)},n.renderInputs=function(){return Object.keys(n.props.values).map(n.renderInput)},n.renderInput=function(e){return a.a.createElement("div",{key:e},a.a.createElement("label",null,e," ",a.a.createElement("input",{type:"text",value:n.props.values[e],name:e,onChange:n.handleInputChange})))},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("div",null,this.props.unitKey),this.renderInputs())}}]),t}(a.a.Component),w=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(d.a)(this,Object(h.a)(t).call(this))).handleSimulateClick=function(){var t=k.simulateGame(e.state.unit1,e.state.unit2);e.setState({results:t})},e.handleUnitPropertyValueChange=function(t,n){e.setState(Object(s.a)({},t,n))},e.renderUnit=function(t,n){return a.a.createElement(U,{values:t,unitKey:n,onChange:e.handleUnitPropertyValueChange})},e.state={results:{turns:0,winner:"press button to start simulation"},unit1:{name:"Unit 1",green:2,yellow:4,red:4,dice:5,attack:4,power:3,defense:2,toughness:1,courage:12,range:0,speed:3.5,fear_level:1,impact_hits:0},unit2:{name:"Unit 2",green:2,yellow:4,red:4,dice:5,attack:4,power:3,defense:2,toughness:1,courage:12,range:0,speed:3.5,fear_level:1,impact_hits:0}},e}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return console.log(this.state.results),a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("h1",null,"Battle simulator"),a.a.createElement("div",null,this.renderUnit(this.state.unit1,"unit1")),a.a.createElement("div",null,this.renderUnit(this.state.unit2,"unit2")),a.a.createElement("button",{onClick:this.handleSimulateClick},"Simulate"),a.a.createElement("h2",null,"Simulation results"),a.a.createElement("div",null,"Turns: ",this.state.results.turns),a.a.createElement("div",null," Winner: ",this.state.results.winner),a.a.createElement("div",null,"Loser order: ",this.state.results.loser_order," ")))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[10,2,1]]]);
//# sourceMappingURL=main.f598391d.chunk.js.map